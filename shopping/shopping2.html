<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>D1优尚--购物车</title>
    <link rel="stylesheet" href="../css/shopping2css">
    <!-- 登录状态 购物车为空 -->
</head>
<body>
	<div class="S_head">
		<div class="ht_login">

            <span class="S_landing">
                <a href="../help.html" target="_blank">帮助中心</a></li>
            </span>
            <div id="h-top-l"></div>
            <!--<span class="S_ShowWelcome"> 您好，-->
                <!--<span>####</span>-->
                <!--欢迎来到D1购物（-->
                <!--<a href="##">退出登录</a>）-->
            <!--</span>-->
        </div>

        <img src="http://images.d1.com.cn/images2012/New/flow/sc_logo.jpg" alt="">
	</div>
    <div class="S_content">
        <div class="S_title">我挑选的商品清单</div>
        <div class="S_tip">温馨提示：1.选购清单中的商品无法保留库存，请您及时结算。2.商品价格、赠品及库存将以订单提交时为准。</div>
         <!-- 登录状态 购物车为空时 class名为S_noCart的div显示-->
       <!--  <div class="S_noCart">您的购物车里没有商品，快去挑选商品吧&nbsp;&nbsp;<a href="##">回到首页>></a></div> -->
    <!-- 登录状态 购物车不为空时 class名为S_noCart的div隐藏或删除 添加class名为S_Cart的div-->
    <div class="S_Cart">
        &nbsp;&nbsp;如下商品，由D1优尚网负责发货
        <table>
            <tr class="S_th">
                <th class="S_th1">图片</th>
                <th class="S_th2">商品名称/编号</th>
                <th class="S_th3">规格</th>
                <th class="S_th4">会员价</th>
                <th class="S_th5">成交价</th>
                <th class="S_th6">数量</th>
                <th class="S_th7">小计</th>
            </tr>
            <!--<tr class="S_Carts">-->
                <!--<td class="S_td1">-->
                    <!--<a href="##"><img src="http://images1.d1.com.cn/shopimg/gdsimg/2016/06/27/0120690220160627181741_1_80.jpg" alt=""></a>-->
                <!--</td>-->
                <!--<td class="S_td2">-->
                    <!--<div id="clearOnes">-->
                        <!--<div id="clearOne">-->
                            <!--<p>您确定删除该商品吗</p>-->
                            <!--<span class="S_ding">确定</span>-->
                            <!--<span class="S_qu">取消</span>-->
                        <!--</div>-->
                        <!--<div class="c_d"></div>-->
                    <!--</div>-->
                    <!--<p>RealBrella锐乐不会淋湿肩膀超轻自动晴雨伞（长柄型）</p>-->
                    <!--<span>01206902</span>-->
                    <!--<br>-->
                    <!--<a class="clear" href="###">删除</a>-->
                    <!--<a href="">加入收藏</a>-->
                <!--</td>-->
                <!--<td class="S_td3">红</td>-->
                <!--<td class="S_td4">99</td>-->
                <!--<td class="S_td5">99</td>-->
                <!--<td class="S_td6">-->
                    <!--<span style="font-size: 20px;cursor:pointer;" class="S_int1">-</span>-->
                    <!--<span style="display:inline-block;font-size:18px;width:42px;height:17px;text-align:center" class="S_int2">1</span>-->
                    <!--<span style="font-size: 20px;cursor:pointer;" class="S_int3">+</span>-->
                <!--</td>-->
                <!--<td class="S_td7">90</td>-->
            <!--</tr>-->
        </table>
        <div class="S_payment">
            <span>购物车商品总计：<span class="S-amount">1</span>件</span>
            &nbsp;&nbsp;&nbsp;&nbsp;
            <span>应付金额：<span class="S_sum">50</span>元</span>
        </div>
        <div class="S_resultbtn">
            <div id="clearAlls">
                <div id="clearAll">
                    <p>您确定删除该商品吗</p> 
                    <span class="S_ding1">确定</span>
                    <span class="S_qu1">取消</span>
                </div>
                <div class="c_c"></div>
            </div>
            <input class="S_cle" type="button" value="x&nbsp;&nbsp;清空购物车列表" style="border:none;background:white;outline: none;">
        <a href="../cosmetics.html?productsort=1&">
            <img src="http://images.d1.com.cn/images2012/New/flow/sc_jxgw.gif" alt="">
        </a>
        <a href="shopping3.html"><input type="image" src="http://images.d1.com.cn/images2012/New/flow/sc_ljjs.gif"></a>

        </div>
    </div>
    <div class="S_mstext">
        <p>【免运费规则】</p>
        <p>1.在线支付、微信支付：实际支付金额满<font color="#a22d48" style="font-weight:bold">88</font>元；不满足条件时，每单收取<font color="#a22d48" style="font-weight:bold">5元</font>运费</p>

        <p>2.货到付款：支付金额超过<font color="#a22d48" style="font-weight:bold">88</font>元的订单支持货到付款。货到付款免运费</p>
    </div>
    <div style="width:885px;height:2px"></div>
    <div class="S_list">
        <div class="S_nav">赠品换购区</div>
        <div >
            <a href="##">D1优尚网：618大促，惊喜领取区<span>(如下赠品限换一个)</span></a>
        </div>
            <div>
                <ul class="S_redemption">
                    <li class="S_redemption1">
                        <div class="S_redemption1_top">
                            <img src="http://images1.d1.com.cn/shopimg/gdsimg/2015/12/02/0120640420170224104936_1_120.jpg" alt="">
                            <span class="S_redemption1_top_newp">
                                <a href="##">&nbsp;HELLO KITTY可爱卡通锁扣不锈钢</a>
                                <p>价值：￥199</p>
                                <p>兑换价：￥29</p>
                            </span>
                        </div>
                        <a href="" style="font-size:12px">在"D1优尚网"店铺</a>
                        <p>全场消费满49元加29元可换购</p>
                        <p>你已达到换购要求</p>
                        <a href="##">
                            <img src="http://images.d1.com.cn/images2014/flow/tjhgon.png" alt="">
                        </a>
                    </li>
                    <li class="S_redemption2">
                        <div class="S_redemption2_top">
                            <img src="http://images1.d1.com.cn/shopimg/gdsimg/2016/01/28/0120657920160129172416_1_120.jpg" alt="">
                            <span class="S_redemption1_top_newp">
                                <a href="##">&nbsp;迪思拜尔发光Micro USB安卓and</a>
                                <p>价值：￥69</p>
                                <p>兑换价：￥10</p>
                            </span>
                        </div>
                        <a href="" style="font-size:12px">在"D1优尚网"店铺</a>
                        <p>全场消费满29元加10元可换购</p>
                        <p>你已达到换购要求</p>
                        <a href="##">
                            <img src="http://images.d1.com.cn/images2014/flow/tjhgon.png" alt="">
                        </a>
                    </li>
                    <li class="S_redemption3">
                        <div class="S_redemption3_top">
                            <img src="http://images1.d1.com.cn/shopimg/gdsimg/2015/12/02/04001509_1_1_120.jpg" alt="">
                            <span class="S_redemption1_top_newp">
                                <a href="##">&nbsp;3M 8110s 儿童防流感防雾霾pm2</a>
                                <p>价值：￥18</p>
                                <p>兑换价：￥3</p>
                            </span>
                        </div>
                        <a href="" style="font-size:12px">在"D1优尚网"店铺</a>
                        <p>全场消费满69元加3元可换购</p>
                        <p>你已达到换购要求</p>
                        <a href="##">
                            <img src="http://images.d1.com.cn/images2014/flow/tjhgon.png" alt="">
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div></div>
</body>
<script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="../js/cookie.js"></script>
<script>
    var name=getCookie("name");
    var states=getCookie("states");
    var pass=getCookie("pass");
    if(states=="true"){
        var newP = document.createElement("p");
        newP.innerHTML=(`
            ${name},你好!欢迎来到D1购物
        `),
            $("#h-top-l").append(newP);
    }else{
        var newP2 = document.createElement("p");
        newP2.innerHTML=(`
            <p>你好，欢迎来到D1购物，请<a style="color:#8cc341;padding: 0 5px" href="../login.html">登录</a>或<a style="color:#8cc341;padding: 0 5px" href="../zhuce.html">注册</a></p>
        `),
            $("#h-top-l").append(newP2);


    }


    var all = window.location.search;
    var c = all.substring(all.indexOf("?")+1,all.indexOf("="));
    var r = all.substring(all.indexOf("=")+1,all.indexOf("&"));

    var s = all.substring(all.lastIndexOf("&")+1,all.lastIndexOf("="));
    var n = all.substring(all.lastIndexOf("=")+1,all.length);

//    var info3=getCookie("info3");

    $.ajax({
        type: "get",
        url: "http://10.80.11.213:8080/buycar",
        data:{
//            info3:info3,
            name:name,
            pass:pass,
            info1:r,
            info2:n
        },
        dataType: "jsonp",
        jsonp:"cb",
        success: function (proInfo) {
            console.log(proInfo)
            var pro=proInfo[0]
            var nub=proInfo[1]
//            console.log(proInfo[0].products[0].coding);
//
//            var arr=[];
//            for(var i=0;i<proInfo[0].products.length;i++){
//                arr.push(proInfo[0].products[i].coding);
//                console.log(arr);

            for(var i = 0;i<pro.length;i++){
                createTr(pro[i],nub[i]);
            }

            lengths = $('table tr').length;
            $('.S-amount').html(lengths-1);
            var sum = 0;

            for(var i = 1;i<lengths;i++){
                sum = sum + parseFloat($('table tr:eq('+i+') .S_td7').html());
            }
            $('.S_sum').html(sum);


            $(".S_Cart").click(function (e) {
                var lengths2 = $('table tr').length;
                $('.S-amount').html(lengths2-1);

                if(e.target.className == "S_int3"){
                    var num = parseInt(e.target.parentNode.children[1].innerHTML);
                    e.target.parentNode.children[1].innerHTML = ++num;
                    var count = parseInt(e.target.parentNode.parentNode.children[4].innerHTML)
                    e.target.parentNode.parentNode.children[6].innerHTML = num*count;

                    var sum2 = 0;
                    for(var j=1;j<lengths2;j++){
                        sum2 += parseFloat(e.target.parentNode.parentNode.parentNode.children[j].children[6].innerHTML);
                    }
                    console.log(sum2);
                    $('.S_sum').html(sum2);
                }
                if(e.target.className == "S_int1"){
                    var num = parseInt(e.target.parentNode.children[1].innerHTML);
                    num--;
                    if(num <= 0){num = 0;}
                    e.target.parentNode.children[1].innerHTML = num;
                    var count = parseInt(e.target.parentNode.parentNode.children[4].innerHTML)
                    e.target.parentNode.parentNode.children[6].innerHTML = num*count;

                    var sum2 = 0;
                    for(var j=1;j<lengths2;j++){
                        sum2 += parseInt(e.target.parentNode.parentNode.parentNode.children[j].children[6].innerHTML);
                    }
                    console.log(sum2);
                    $('.S_sum').html(sum2);
                }


            })

            }
    })




    var a = 0;
    var mids = $('.S_Cart>table');
//    $.ajax({
//        url:'http://10.80.11.213:8080/allproInfo',
//        async:true,
//        data:{
//            arr:arr,
//        },
//        dataType:'jsonp',
//        jsonp:'cb',
//        success:function (data) {
//            var pro = [];
////            console.log(data[0]);
//            pro.push(data[0]);
//            pro.push(data[1]);
//            pro.push(data[45]);
//            pro.push(data[46]);
//
//            for(var i = 0;i<pro.length;i++){
//                createTr(pro[i]);
//            }
//            lengths = $('table tr').length;
//            $('.S-amount').html(lengths-1);
//            var sum = 0;
//
//            for(var i = 1;i<lengths;i++){
//                sum = sum + parseFloat($('table tr:eq('+i+') .S_td7').html());
//            }
//            $('.S_sum').html(sum);
//
//
//            $(".S_Cart").click(function (e) {
//                var lengths2 = $('table tr').length;
//                $('.S-amount').html(lengths2-1);
//
//                if(e.target.className == "S_int3"){
//                    var num = parseInt(e.target.parentNode.children[1].innerHTML);
//                    e.target.parentNode.children[1].innerHTML = ++num;
//                    var count = parseInt(e.target.parentNode.parentNode.children[4].innerHTML)
//                    e.target.parentNode.parentNode.children[6].innerHTML = num*count;
//
//                    var sum2 = 0;
//                    for(var j=1;j<lengths2;j++){
//                        sum2 += parseFloat(e.target.parentNode.parentNode.parentNode.children[j].children[6].innerHTML);
//                    }
//                    console.log(sum2);
//                    $('.S_sum').html(sum2);
//                }
//                if(e.target.className == "S_int1"){
//                    var num = parseInt(e.target.parentNode.children[1].innerHTML);
//                    num--;
//                    if(num <= 0){num = 0;}
//                    e.target.parentNode.children[1].innerHTML = num;
//                    var count = parseInt(e.target.parentNode.parentNode.children[4].innerHTML)
//                    e.target.parentNode.parentNode.children[6].innerHTML = num*count;
//
//                    var sum2 = 0;
//                    for(var j=1;j<lengths2;j++){
//                        sum2 += parseInt(e.target.parentNode.parentNode.parentNode.children[j].children[6].innerHTML);
//                    }
//                    console.log(sum2);
//                    $('.S_sum').html(sum2);
//                }
//
//
//            })
//        }
//    })
    function createTr(obj,obj2){
        var pro = obj;
        var nub=obj2;
        var tr = document.createElement("tr");
        tr.setAttribute("class","S_Carts");
        tr.innerHTML = '<td class="S_td1"><a href="##"><img src="'+pro.smallImgPath1+'" alt=""></a></td><td class="S_td2"> <div class="clearOnes"><div class="clearOne"><p>您确定删除该商品吗</p><span id="S_ding" class="S_ding">确定</span> <span class="S_qu">取消</span></div><div class="c_d"></div></div><p>'+pro.productName+'</p><span>'+pro.coding+'</span><br><a class="clear" href="###">删除</a> <a href="###">加入收藏</a></td><td class="S_td3">'+pro.apply+'</td><td class="S_td4">'+pro.newPrice+'</td><td class="S_td5">'+pro.newPrice+'</td><td class="S_td6"><span style="font-size: 20px;cursor:pointer;" class="S_int1">-</span><span style="display:inline-block;font-size:18px;width:42px;height:17px;text-align:center" class="S_int2">'+nub+'</span><span style="font-size: 20px;cursor:pointer;" class="S_int3">+</span></td><td class="S_td7">'+pro.newPrice+'</td>';
        var btns1 = tr.getElementsByTagName('span')[0];
        var btns2 = tr.getElementsByTagName('span')[1];
        var clear = tr.getElementsByTagName('a')[1];
        var ding = tr.getElementsByTagName('div')[0];





        /*var nums =1;
        jian.onclick = function () {
            nums--;
            if(nums<=1){nums = 1;}
            console.log(nums);

//            console.log(zi.val());
//            zi.innerHTML(nums);
        }
        jia.onclick = function () {
            nums++;
            console.log(nums);

//            console.log(zi.val());
//            zi2.val(nums);
        }*/

        // 删除
        btns1.onclick = function () {
         tr.remove();
         }
         btns2.onclick = function () {
         ding.style.display = 'none';
         }

         clear.onclick = function () {
         ding.style.display = 'block';
         }

        mids.append(tr);
    }


    $('.S-amount').html($('.S_Cart>table tr').length - 1);

    $('.clear').click(function(){
        $('#clearOnes').toggle();
    })
    $('.S_qu').click(function(){
        $('#clearOnes').hide();
    })

     $('.S_cle').click(function(){
         $('#clearAlls').toggle();
     })
     $('.S_qu1').click(function(){
         $('#clearAlls').hide();
     })
     $('.S_ding1').click(function(){
         $('.S_Carts').remove();
         $('#clearAlls').hide();
         $('.S-amount').html(0);
     })

//    $("#S_ding").click(function () {
//        $.ajax({
//            type: "get",
//            url: "http://10.80.11.213:8080/remove",
//            data:{
//                name:name,
//                pass:pass,
//            },
//            dataType: "jsonp",
//            jsonp:"cb",
//            success: function (data) {
//                console.log(data)
//            }
//        })
//    })


</script>
</html>